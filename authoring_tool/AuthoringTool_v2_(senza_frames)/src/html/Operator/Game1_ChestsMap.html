<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
	<meta charset="ISO-8859-1">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>
	<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?key=AIzaSyCrHxpT62yPIguYjilGuX_pGkOqQYvS-NQ&sensor=false"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0-beta1/jquery.min.js" type="text/javascript"></script>
	
	<link data-require="bootstrap-css@3.1.1" data-semver="3.1.1" rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" />
    <script>document.write('<base href="' + document.location + '" />');</script>
    <script data-require="google-maps@*" data-semver="1.0.0" src="http://maps.google.com/maps/api/js?sensor=false"></script>
    <script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?key=AIzaSyCrHxpT62yPIguYjilGuX_pGkOqQYvS-NQ&sensor=false"></script>
    <script data-require="jquery@*" data-semver="2.1.1" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script data-require="angular.js@1.2.x" src="https://code.angularjs.org/1.2.22/angular.js" data-semver="1.2.22"></script>
    <script data-require="angular-route@*" data-semver="1.2.14" src="http://code.angularjs.org/1.2.14/angular-route.js"></script>
    <script data-require="angular-resource@*" data-semver="1.2.14" src="http://code.angularjs.org/1.2.14/angular-resource.js"></script>
    <script data-require="angular-bootstrap@0.11.0" data-semver="0.11.0" src="http://angular-ui.github.io/bootstrap/ui-bootstrap-tpls-0.11.0.js"></script>
    <script data-require="bootstrap@*" data-semver="3.1.1" src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="ng-map/ng-map.min.js"></script>
    <script src="https://rawgit.com/allenhwkim/angularjs-google-maps/master/build/scripts/ng-map.debug.js"></script>
</head>
<body ng-app="GoPoleis">

	<div class="col-sm-9" ng-controller="ChestsMapController">
	
<!-- 		<map zoom-to-include-markers="auto" center="[{{ center.lat }}, {{ center.lng }}]"  style="height:400px; width:1450px;" on-rightclick="addNewTC(center.lat)">     
	    	<marker ng-repeat="result in results track by $index" position="[{{ result.latitude }}, {{ result.longitude }}]"></marker>
	    </map> -->
	    
	    <div id="map" style="width: 1450px; height: 350px"></div> 
	    
	    <p id="centerLatitude" ng-module="centerLatitude">{{center.lat}}</p>
		<p id="centerLongitude" ng-module="centerLatitude">{{center.lng}}</p>
	    
	</div>
    
</body>
</html>
<script>
var app = angular.module('GoPoleis', ['ui.bootstrap','ngMap']);
app.controller('ChestsMapController', function($scope, $http, $window, $timeout, $modal, $rootScope) {

	var map = new google.maps.Map(document.getElementById("map"));
	$scope.chCode = 1;	
	
	$http({
		method : "GET",
		url : "/getCHTreasureChests/"+$scope.chCode
	}).then(function mySucces(response) {
		results  = response.data;
		setMarkers(map, results);

	}, function myError(response) {
		$scope.results  = response.statusText;
	});	

	function setMarkers(map, markers) {
		var bounds = new google.maps.LatLngBounds();
		for (var i = 0; i < markers.length; i++) {
			var chest = markers[i];
		    var chestPosition = new google.maps.LatLng(chest.latitude, chest.longitude);
		    var marker = new google.maps.Marker({
		    	position: chestPosition,
		    	map: map,
				icon: 'https://maps.google.com/mapfiles/ms/icons/red-dot.png',
		    });
		    bounds.extend(chestPosition);
		}
		map.fitBounds(bounds);
	}
	
	map.addListener('rightclick', function(event) {    //quendo si preme il tasto destro richiama la funzione addChest dalla finestra genitore [rigthclick, dblclick, click]     	
		parent.window.addTC(map.getCenter().lat(), map.getCenter().lng(), map.getZoom());
	}); 

});   
</script>