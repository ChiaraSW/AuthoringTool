<!DOCTYPE html>
<html>
<head>
	<meta charset="ISO-8859-1">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>
</head>

<body ng-app="GoPoleis" >

	<div class="col-sm-9" ng-controller="getCHsController">
		<div ng-show="getCHsPage">
			<h1 style="margin:20px;"><u>Cultural Heritages</u></h1>
			<fieldset style="margin-top:50px; margin-left:20px;""> 	
	           	<label for="search" style="display: inline-block; vertical-align: bottom;" >
		        	<span class="glyphicon glyphicon-search"></span>
		        	Search: 
		        </label>
	      		<input type="text" ng-model="searchBoxCHs.name" class="form-control" style="width:250px; display: inline-block; vertical-align: bottom;"/>
	        </fieldset>
  	        <ul style="list-item-style:none; margin-left:0px; padding-left:0px; width: 1500px;">
	       		<li ng-repeat="ch in results | filter:searchBoxCHs" class="thumbnail col-sm-3" style=" margin:20px; padding: 20px; width:450px; text-align:left;" 
	       			ng-model="getOperatorCHs.selection" ng-value="ch.name" id="{{ch.name}}" ng-click="updCH(ch.code)">	        	
	        		<h4 ch.name="selection">
	        			<img ng-src="{{ch.path}}" style="height: 80px; width: 80px;"/>
	        			{{ ch.name }}
	        		</h4>	
	       		</li>
	        </ul>
        </div>
        
        
       <div ng-show="updCHPage">
			        
			<h1 style="margin:20px;"><u>Update Card</u>: [{{updCH.name}}]</h1><br><br>        
	        
	     	<fieldset style="margin-top:50px; margin-left:20px;"> 	
		     	<label for="name" style="display: inline-block; vertical-align: bottom;">
		     		Name: 
				</label>
				<input type="text" class="form-control" ng-model="updCH.name" style="width:450px; display: inline-block;">
			</fieldset>
			
			<fieldset style="margin-top:30px; margin-left:20px;"> 	
		     	<label for="description" style="display: inline-block; vertical-align: bottom;">
		     		Description: 
				</label>
				<input type="text" class="form-control" ng-model="updCH.description" style="width:850px; display: inline-block;">
			</fieldset>
			
 			<fieldset style="margin-top:30px; margin-left:20px;"> 	
		     	<label for="image" style="display: inline-block;">
		     		Image:  
				</label>
				<img ng-src="{{updCH.path}}" ng-model="updCH.path" style="width: 200px; heigth:200px; border: 1px solid black; "/>
			</fieldset>
			
			<fieldset style="margin-top:30px; margin-left:20px;"> 	
				<label for="games" style="display: inline-block;">
		     		Games:  
				</label>
		     	<form style="display: inline-block;">			
					<input type="checkbox" ng-model="updCH.g1" ng-true-value="1" ng-false-value="0"> 1
					<input type="checkbox" ng-model="updCH.g2" ng-true-value="1" ng-false-value="0"> 2
		          	<input type="checkbox" ng-model="updCH.g3" ng-true-value="1" ng-false-value="0"> 3
		          	<input type="checkbox" ng-model="updCH.g4" ng-true-value="1" ng-false-value="0"> 4      
				</form>
			</fieldset>	
			
			
			
			
			<!-- PARTE DELLA MAPPA!!! -->
			
			
			
			
			<fieldset style="margin-top:30px; margin-left:20px;"> 	
		     	<label for="coordinates" style="display: inline-block; vertical-align: bottom; width:150px;">
		     		Coordinates: 
				</label>
				Latitude <input type="text" class="form-control" ng-model="updCH.latitude" style="width:250px; display: inline-block;" ng-readonly="true" disabled>
				Longitude <input type="text" class="form-control" ng-model="updCH.longitude" style="width:250px; display: inline-block;" ng-readonly="true" disabled>
			</fieldset>	
			
			<fieldset style="margin-top:30px; margin-left:20px;"> 	
		     	<label for="region" style="display: inline-block;">
		     		Region:  
				</label>
				<select ng-model="updCH.region" class="form-control" style="width:250px; display: inline-block;">
					<option ng-repeat="x in regions">{{x}}</option>
				</select>	
				<label for="historicalPeriod" style="display: inline-block;">
		     		Historical period:  
				</label>
				<select ng-model="updCH.historicalPeriod" class="form-control" style="width:250px; display: inline-block;">
					<option ng-repeat="y in historicalPeriods">{{y}}</option>
				</select>	
				<label for="typeOfStructure" style="display: inline-block;">
		     		Type of structure: 
				</label>
				<select ng-model="updCH.typeOfStructure" class="form-control" style="width:250px; display: inline-block;">
					<option ng-repeat="z in typeOfStructures">{{z}}</option>
				</select>
				
			</fieldset>	
			
			<fieldset style="margin-top:60px; margin-left:200px; margin-bottom:50px;"> 			
				<input type="submit" name="btnUpdCH" class="btn btn-info" ng-click="executeUpdCH()" value="Update"/>  
				<a href="CulturalHeritages_Template.html" target="_self">Cancel</a>
			</fieldset>	
	        
		</div> 
        
	</div>

</body>
</html>
<script>
	var app = angular.module("GoPoleis", []);
	app.controller('getCHsController', function($scope, $http, $window) {
		$scope.getCHsPage=true;
		$scope.updCHPage=false;

		$http({
			method : "GET",
			url : "/getOperatorCHs/statoitaliano@gmail.com"
		}).then(function mySucces(response) {
			$scope.results  = response.data;
		}, function myError(response) {
			$scope.results  = response.statusText;
		});
			
		
		$scope.updCH = function(chCode){ 
			$scope.getCHsPage=false;
			$scope.updCHPage=true;
			$scope.updCH={};
			
			$scope.regions = ["Abruzzo", "Basilicata", "Calabria", "Campania", "Emilia-Romagna", "Friuli-Venezia Giulia", "Lazio", "Liguria", "Lombardia", "Marche", "Molise", 
				  "Piemonte", "Puglia", "Sardegna", "Sicilia", "Toscana", "Trentino-Alto Adige", "Umbria", "Valle d'Aosta", "Veneto"];							//Mettere la query
			$scope.historicalPeriods = ["Romano", "Medievo"];				//Mettere la query
			$scope.typeOfStructures = ["Chiesa", "Museo", "Fontana"];		//Mettere la query

			$http({
				method : "GET",
				url : "/getCH/"+chCode
			}).then(function mySucces(response) {
				results  = response.data;	
				if (results.length > 0){
					$scope.updCH.name = results[0].name;
					$scope.updCH.description = results[0].description;
					$scope.updCH.path = results[0].path;
					$scope.updCH.g1 = results[0].g1;
					$scope.updCH.g2 = results[0].g2;
					$scope.updCH.g3 = results[0].g3;
					$scope.updCH.g4 = results[0].g4;
					$scope.updCH.latitude = results[0].latitude;
					$scope.updCH.longitude = results[0].longitude;				
					$scope.updCH.region = results[0].region;
					$scope.updCH.province = results[0].province;
					$scope.updCH.historicalPeriod = results[0].historicalperiod;
					$scope.updCH.typeOfStructure = results[0].structuretype;
				}
			}, function myError(response) {
				$scope.results  = response.statusText;
			});	
			
			$scope.executeUpdCH = function(){	
				$http({
					method: 'GET',					
					url:'/updCH/'+$scope.updCH.name+'/'+$scope.updCH.description+'/..%2F..%2Fimages%2Fheritages%2Fnoimage.png/'+$scope.updCH.g1+'/'+$scope.updCH.g2+'/'+$scope.updCH.g3+
						'/'+$scope.updCH.g4+'/'+$scope.updCH.latitude+'/'+$scope.updCH.longitude+'/'+$scope.updCH.region+'/'+$scope.updCH.province+'/'+$scope.updCH.historicalPeriod+
						'/'+$scope.updCH.typeOfStructure+'/statoitaliano@gmail.com/'+chCode //SISTEMARE!!	
				}).then(function successCallback(response) {	
					window.open("CulturalHeritages_Template.html", "_self");   
				}, function errorCallback(response) {
					// called asynchronously if an error occurs
					// or server returns response with an error status.
				});
			}
		}
			
	});
</script>